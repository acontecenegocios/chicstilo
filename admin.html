<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Admin Chicstilo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

<style>

body{
font-family: Arial;
background:#f4f4f4;
margin:0;
padding:10px;
}

.header{
background:black;
color:white;
padding:15px;
text-align:center;
font-size:20px;
}

.container{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
gap:10px;
margin-top:10px;
}

.card{
background:white;
border-radius:10px;
padding:10px;
}

.card img{
width:100%;
border-radius:10px;
}

.btn{
display:block;
color:white;
text-align:center;
padding:10px;
margin-top:5px;
text-decoration:none;
border-radius:5px;
cursor:pointer;
border:none;
}

.excluir{
background:red;
}

</style>

</head>
<body>

<div class="header">
Admin Chicstilo
</div>

<input type="file" id="fotos" multiple>

<button onclick="upload()">Enviar Produto</button>

<div class="container" id="produtos"></div>

<script>

const supabaseClient = supabase.createClient(
"https://pupqmtogotalkrppzkzd.supabase.co",
"sb_publishable_mEb4-SGlEs8Sq7IM_UQl-Q_P-Yy1O4V"
);

async function upload(){

const files = document.getElementById("fotos").files;

if(files.length == 0){
alert("Selecione fotos");
return;
}

if(files.length > 5){
alert("MÃ¡ximo 5 fotos");
return;
}

let urls=[];

for(let file of files){

const nome = Date.now()+"_"+file.name;

const { error } = await supabaseClient
.storage
.from("fotos")
.upload(nome,file);

if(error){
alert("Erro upload");
return;
}

const url =
"https://pupqmtogotalkrppzkzd.supabase.co/storage/v1/object/public/fotos/"+nome;

urls.push(url);

}

const codigo = "PROD-"+Date.now();

await supabaseClient
.from("produtos")
.insert({

codigo:codigo,
foto_url:urls[0],
fotos:urls

});

alert("Produto enviado");

carregar();

}

async function excluir(id){

if(!confirm("Excluir produto?")) return;

await supabaseClient
.from("produtos")
.delete()
.eq("id",id);

carregar();

}

async function carregar(){

const { data } = await supabaseClient
.from("produtos")
.select("*")
.order("codigo",{ascending:true});

const container =
document.getElementById("produtos");

container.innerHTML="";

data.forEach(p=>{

container.innerHTML+=`

<div class="card">

${p.foto_url ? `<img src="${p.foto_url}">` : ""}

<b>${p.codigo}</b>

<button class="btn excluir"
onclick="excluir('${p.id}')">
Excluir
</button>

</div>

`;

});

}

carregar();

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Chicstilo</title>
</head>

<body style="font-family:Arial; padding:20px;">

<h2>Admin Chicstilo</h2>

<div>

<label>Marca</label><br>
<input type="text" id="marca"><br><br>

<label>Tamanho</label><br>
<input type="text" id="tamanho"><br><br>

<label>Cor</label><br>
<input type="text" id="cor"><br><br>

<label>Preço</label><br>
<input type="text" id="preco"><br><br>

<label>Observações</label><br>
<textarea id="observacoes"></textarea><br><br>

<label>Fotos (até 5)</label><br>
<input type="file" id="fotos" multiple><br><br>

<button id="btnSalvar">SALVAR PRODUTO</button>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>

const supabase = window.supabase.createClient(
"https://pupqmtogotalkrppzkzd.supabase.co",
"sb_publishable_mEb4-SGlEs8Sq7IM_UQl-Q_P-Yy1O4V"
);

document.getElementById("btnSalvar").onclick = salvar;

async function salvar(){

const files = document.getElementById("fotos").files;

if(files.length == 0){
alert("Selecione uma foto");
return;
}

if(files.length > 5){
alert("Máximo 5 fotos");
return;
}

let urlFoto="";

const file = files[0];

const nome = Date.now()+"_"+file.name;

const { error: erroUpload } =
await supabase.storage.from("fotos").upload(nome,file);

if(erroUpload){
alert("Erro upload");
console.log(erroUpload);
return;
}

urlFoto =
"https://pupqmtogotalkrppzkzd.supabase.co/storage/v1/object/public/fotos/"+nome;

const { error } =
await supabase.from("produtos").insert({

marca:document.getElementById("marca").value,
tamanho:document.getElementById("tamanho").value,
cor:document.getElementById("cor").value,
preco:document.getElementById("preco").value,
observacoes:document.getElementById("observacoes").value,
foto_url:urlFoto

});

if(error){
alert("Erro salvar produto");
console.log(error);
return;
}

alert("Produto salvo com sucesso");

}

</script>

</body>
</html>

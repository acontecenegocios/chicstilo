<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Catálogo Chic Stilo</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Montserrat', sans-serif; padding: 1rem; background: #f7f7f7; }
  h1 { color: #ff4081; }
  form { background: #fff; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); margin-bottom: 2rem; }
  form input, form textarea { width: 100%; margin-bottom: 0.5rem; padding: 0.5rem; border-radius: 4px; border: 1px solid #ccc; }
  form button { padding: 0.5rem 1rem; background: #ff4081; color: #fff; border: none; cursor: pointer; border-radius: 4px; }
  table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 8px; overflow: hidden; }
  table th, table td { padding: 0.5rem; border-bottom: 1px solid #eee; text-align: left; }
  table th { background: #ff4081; color: #fff; }
  img { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; }
  .btn-delete { background: #e53935; padding: 0.3rem 0.6rem; color: #fff; border: none; cursor: pointer; border-radius: 4px; }
</style>
</head>
<body>

<h1>Admin - Catálogo Chic Stilo</h1>

<form id="formProduto">
  <input type="text" id="codigo" placeholder="Código do Produto" required>
  <input type="text" id="produto" placeholder="Nome do Produto" required>
  <input type="text" id="tamanho" placeholder="Tamanho" required>
  <input type="text" id="marca" placeholder="Marca" required>
  <input type="number" id="valor" placeholder="Valor (R$)" required>
  <textarea id="descritivo" placeholder="Descritivo" required></textarea>
  <input type="file" id="foto" accept="image/*" required>
  <button type="submit">Adicionar Produto</button>
</form>

<table id="tabelaProdutos">
  <thead>
    <tr>
      <th>Foto</th>
      <th>Código</th>
      <th>Produto</th>
      <th>Tamanho</th>
      <th>Marca</th>
      <th>Valor</th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody>
    <!-- Produtos aparecerão aqui -->
  </tbody>
</table>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabaseUrl = 'SEU_SUPABASE_URL'
const supabaseKey = 'SUA_SUPABASE_ANON_KEY'
const supabase = createClient(supabaseUrl, supabaseKey)

const form = document.getElementById('formProduto')
const tabela = document.getElementById('tabelaProdutos').querySelector('tbody')

// Carregar produtos
async function carregarProdutos() {
  tabela.innerHTML = ''
  let { data: produtos } = await supabase.from('produtos').select('*').order('id', { ascending: true })
  produtos.forEach(prod => {
    const tr = document.createElement('tr')
    tr.innerHTML = `
      <td><img src="${prod.foto_url}" alt="${prod.produto}"></td>
      <td>${prod.codigo}</td>
      <td>${prod.produto}</td>
      <td>${prod.tamanho}</td>
      <td>${prod.marca}</td>
      <td>R$ ${prod.valor}</td>
      <td><button class="btn-delete" onclick="deletarProduto(${prod.id})">Excluir</button></td>
    `
    tabela.appendChild(tr)
  })
}

// Deletar produto
async function deletarProduto(id) {
  await supabase.from('produtos').delete().eq('id', id)
  carregarProdutos()
}

// Adicionar produto
form.addEventListener('submit', async (e) => {
  e.preventDefault()
  const codigo = document.getElementById('codigo').value
  const produto = document.getElementById('produto').value
  const tamanho = document.getElementById('tamanho').value
  const marca = document.getElementById('marca').value
  const valor = document.getElementById('valor').value
  const descritivo = document.getElementById('descritivo').value
  const foto = document.getElementById('foto').files[0]

  if (!foto) return alert('Selecione uma foto!')

  const fotoName = `${Date.now()}_${foto.name}`
  const { data: fotoData, error: uploadError } = await supabase.storage
    .from('produtos')
    .upload(fotoName, foto)

  if (uploadError) return alert('Erro ao enviar a imagem: ' + uploadError.message)

  const foto_url = `${supabaseUrl}/storage/v1/object/public/produtos/${fotoName}`

  await supabase.from('produtos').insert([
    { codigo, produto, tamanho, marca, valor, descritivo, foto_url }
  ])

  form.reset()
  carregarProdutos()
})

// Inicializa
carregarProdutos()
</script>

</body>
</html>